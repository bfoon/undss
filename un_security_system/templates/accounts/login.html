{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign In · UNPASS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,300&display=swap" rel="stylesheet">

    <style>
        :root {
            --blue:      #009edb;
            --blue-dark: #005a8b;
            --blue-deep: #001f3f;
            --blue-mid:  #003d5c;
            --white:     #ffffff;
            --off-white: #f7f8fa;
            --border:    #e4e7ec;
            --text:      #0d1b2a;
            --muted:     #6b7685;
            --success:   #12b76a;
            --error:     #f04438;
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

        html, body { min-height: 100%; font-family: 'DM Sans', -apple-system, sans-serif; color: var(--text); }

        /* ── Full-page background ─────────────────────────── */
        .page {
            min-height: 100vh;
            width: 100%;
            background: linear-gradient(160deg, var(--blue-deep) 0%, var(--blue-mid) 55%, #006fa0 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2.5rem 1rem;
            position: relative;
            overflow: hidden;
        }

        /* Noise grain overlay */
        .page::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
            opacity: .45;
            pointer-events: none;
            z-index: 0;
        }

        /* Ambient glow blobs */
        .blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(90px);
            pointer-events: none;
            z-index: 0;
        }
        .blob-1 { width: 420px; height: 420px; top: -130px; left: -110px;
            background: radial-gradient(circle, rgba(0,158,219,.2) 0%, transparent 70%); }
        .blob-2 { width: 360px; height: 360px; bottom: -100px; right: -80px;
            background: radial-gradient(circle, rgba(0,90,139,.28) 0%, transparent 70%); }

        /* Decorative concentric rings */
        .rings {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%,-50%);
            pointer-events: none;
            z-index: 0;
        }
        .rings span {
            position: absolute;
            border-radius: 50%;
            top: 50%; left: 50%;
            transform: translate(-50%,-50%);
            border: 1px solid rgba(255,255,255,.07);
        }
        .rings span:nth-child(1) { width: 280px;  height: 280px;  border-color: rgba(255,255,255,.11); }
        .rings span:nth-child(2) { width: 430px;  height: 430px; }
        .rings span:nth-child(3) { width: 580px;  height: 580px;  border-color: rgba(255,255,255,.04); }
        .rings span:nth-child(4) { width: 730px;  height: 730px;  border-color: rgba(255,255,255,.025); }

        /* ── Brand mark above the card ───────────────────── */
        .brand {
            position: relative;
            z-index: 2;
            text-align: center;
            margin-bottom: 1.75rem;
            animation: fadeUp .55s ease both;
        }

        .brand-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: .7rem;
            margin-bottom: .4rem;
        }

        .brand-logo img {
            height: 42px;
            opacity: .95;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,.3));
        }

        .wordmark {
            font-family: 'DM Serif Display', Georgia, serif;
            font-size: 1.85rem;
            color: var(--white);
            letter-spacing: 5px;
            line-height: 1;
        }

        .brand-sub {
            color: rgba(255,255,255,.48);
            font-size: .76rem;
            font-weight: 300;
            letter-spacing: .3px;
        }

        /* ── Card ────────────────────────────────────────── */
        .card {
            position: relative;
            z-index: 2;
            width: 100%;
            max-width: 430px;
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 24px 64px rgba(0,0,0,.38), 0 0 0 1px rgba(255,255,255,.07);
            overflow: hidden;
            animation: fadeUp .65s .08s ease both;
        }

        /* Card header strip */
        .card-head {
            padding: 1.75rem 2rem 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .eyebrow {
            display: flex;
            align-items: center;
            gap: .45rem;
            color: var(--blue);
            font-size: .72rem;
            font-weight: 600;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            margin-bottom: .6rem;
        }

        .card-title {
            font-family: 'DM Serif Display', Georgia, serif;
            font-size: 1.7rem;
            color: var(--text);
            line-height: 1.15;
            margin-bottom: .3rem;
        }

        .card-subtitle {
            color: var(--muted);
            font-size: .85rem;
            font-weight: 300;
        }

        /* Card body */
        .card-body { padding: 1.75rem 2rem; }

        /* ── Alerts ──────────────────────────────────────── */
        .alerts { margin-bottom: 1.2rem; }

        .alert {
            display: flex;
            align-items: flex-start;
            gap: .6rem;
            padding: .8rem 1rem;
            border-radius: 10px;
            font-size: .84rem;
            border: 1px solid transparent;
            margin-bottom: .5rem;
            animation: slideDown .3s ease;
        }
        .alert:last-child { margin-bottom: 0; }
        .alert i { flex-shrink: 0; font-size: .95rem; margin-top: .05rem; }
        .alert-danger  { background:#fef3f2; border-color:#fecdca; color:#b42318; }
        .alert-success { background:#ecfdf3; border-color:#a9efc5; color:#067647; }
        .alert-info    { background:#f0f9ff; border-color:#b9e6fe; color:#026aa2; }
        .alert-warning { background:#fffaeb; border-color:#fedf89; color:#b54708; }

        .alert-close {
            margin-left: auto; background: none; border: none;
            cursor: pointer; opacity: .5; transition: opacity .2s;
            padding: 0; color: inherit; line-height: 1; flex-shrink: 0;
        }
        .alert-close:hover { opacity: 1; }

        /* ── Form fields ─────────────────────────────────── */
        .field { margin-bottom: 1.1rem; }

        .field-label {
            display: block;
            font-size: .8rem;
            font-weight: 600;
            color: var(--text);
            margin-bottom: .42rem;
        }

        .field-wrap { position: relative; }

        .field-icon {
            position: absolute;
            left: .9rem; top: 50%;
            transform: translateY(-50%);
            color: var(--muted);
            font-size: 1rem;
            pointer-events: none;
            transition: color .2s;
            z-index: 2;
        }

        .field-input {
            width: 100%;
            height: 48px;
            padding: 0 2.75rem 0 2.65rem;
            border: 1.5px solid var(--border);
            border-radius: 10px;
            font-size: .9rem;
            font-family: inherit;
            color: var(--text);
            background: var(--off-white);
            transition: border-color .2s, box-shadow .2s, background .2s;
            outline: none;
        }
        .field-input::placeholder { color: #aab0ba; }
        .field-input:hover:not(:focus) { border-color: #bcc2cc; }
        .field-input:focus {
            border-color: var(--blue);
            box-shadow: 0 0 0 3.5px rgba(0,158,219,.12);
            background: var(--white);
        }
        .field-wrap:focus-within .field-icon { color: var(--blue); }
        .field-input.is-valid   { border-color: var(--success); background: var(--white); }
        .field-input.is-invalid { border-color: var(--error); box-shadow: 0 0 0 3.5px rgba(240,68,56,.1); }

        .field-error { font-size: .76rem; color: var(--error); margin-top: .3rem; }

        /* Password toggle */
        .pw-toggle {
            position: absolute;
            right: .8rem; top: 50%;
            transform: translateY(-50%);
            background: none; border: none;
            padding: .25rem; cursor: pointer;
            color: var(--muted); font-size: 1.05rem;
            transition: color .2s; z-index: 2; line-height: 1;
        }
        .pw-toggle:hover { color: var(--blue); }

        /* ── Options row ─────────────────────────────────── */
        .options-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .remember {
            display: flex; align-items: center;
            gap: .45rem; cursor: pointer;
        }
        .remember input[type="checkbox"] {
            width: 16px; height: 16px;
            border: 1.5px solid var(--border);
            border-radius: 4px; cursor: pointer;
            accent-color: var(--blue); flex-shrink: 0;
        }
        .remember span { font-size: .84rem; color: var(--muted); user-select: none; }

        /* Forgot popover wrapper */
        .forgot-wrap { position: relative; }

        .forgot-link {
            font-size: .82rem; color: var(--blue);
            text-decoration: none; font-weight: 500;
            transition: color .2s;
        }
        .forgot-link:hover { color: var(--blue-dark); text-decoration: underline; }

        .forgot-popover {
            display: none;
            position: absolute;
            bottom: calc(100% + 10px);
            right: 0;
            background: var(--text);
            color: var(--white);
            padding: .85rem 1rem;
            border-radius: 10px;
            font-size: .8rem;
            line-height: 1.55;
            width: 228px;
            z-index: 50;
            box-shadow: 0 8px 28px rgba(0,0,0,.28);
            animation: fadeUp .2s ease;
        }
        .forgot-popover.show { display: block; }
        .forgot-popover strong { display: block; margin-bottom: .3rem; }
        .forgot-popover::after {
            content: ''; position: absolute;
            bottom: -5px; right: 14px;
            width: 10px; height: 10px;
            background: var(--text);
            transform: rotate(45deg);
            border-radius: 2px;
        }

        /* ── Submit button ───────────────────────────────── */
        .btn-sign {
            width: 100%; height: 50px;
            border: none; border-radius: 10px;
            background: linear-gradient(135deg, var(--blue) 0%, var(--blue-dark) 100%);
            color: var(--white);
            font-family: inherit; font-size: .95rem;
            font-weight: 600; letter-spacing: .3px;
            cursor: pointer; position: relative; overflow: hidden;
            transition: transform .15s, box-shadow .15s;
        }
        .btn-sign:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,90,139,.38);
        }
        .btn-sign:active:not(:disabled)  { transform: translateY(0); box-shadow: none; }
        .btn-sign:disabled { opacity: .72; cursor: not-allowed; }

        .btn-inner {
            display: flex; align-items: center;
            justify-content: center; gap: .5rem;
            transition: opacity .2s;
        }
        .btn-loader {
            position: absolute; inset: 0;
            display: flex; align-items: center;
            justify-content: center;
            opacity: 0; transition: opacity .2s;
        }
        .btn-loader .spinner-border { width: 1.2rem; height: 1.2rem; border-width: 2px; }
        .btn-sign.loading .btn-inner  { opacity: 0; }
        .btn-sign.loading .btn-loader { opacity: 1; }

        /* Security note */
        .sec-note {
            display: flex; gap: .45rem;
            align-items: flex-start;
            font-size: .74rem; color: var(--muted);
            line-height: 1.5; margin-top: 1.1rem;
        }
        .sec-note i { flex-shrink: 0; color: var(--blue); margin-top: .1rem; }

        /* ── Card footer ─────────────────────────────────── */
        .card-foot {
            padding: 1rem 2rem;
            background: var(--off-white);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: .5rem;
        }
        .foot-copy { font-size: .71rem; color: #aab0ba; }
        .foot-links { display: flex; gap: 1rem; }
        .foot-links a {
            font-size: .71rem; color: #aab0ba;
            text-decoration: none; transition: color .2s;
        }
        .foot-links a:hover { color: var(--blue); }

        /* ── Trust strip below card ──────────────────────── */
        .trust-strip {
            position: relative; z-index: 2;
            margin-top: 1.5rem;
            display: flex; justify-content: center;
            gap: 1.75rem; flex-wrap: wrap;
            animation: fadeUp .65s .2s ease both;
        }
        .trust-item {
            display: flex; align-items: center;
            gap: .4rem; color: rgba(255,255,255,.48);
            font-size: .74rem;
        }
        .trust-item i { color: rgba(0,158,219,.8); font-size: .82rem; }

        /* ── Animations ──────────────────────────────────── */
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(16px); }
            to   { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-8px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* ── Responsive ──────────────────────────────────── */
        @media (max-width: 500px) {
            .page       { padding: 1.5rem .75rem; }
            .card       { border-radius: 16px; }
            .card-head  { padding: 1.5rem 1.5rem 1.25rem; }
            .card-body  { padding: 1.5rem 1.5rem; }
            .card-foot  { padding: .875rem 1.5rem; }
            .trust-strip { gap: 1rem; }
            .forgot-popover { right: -0.5rem; }
        }

        @media (max-height: 680px) {
            .page { padding: 1rem; }
            .brand { margin-bottom: 1.1rem; }
            .brand-sub { display: none; }
        }

        :focus-visible { outline: 2px solid var(--blue); outline-offset: 2px; }
    </style>
</head>

<body>
<div class="page">

    <!-- Background decorations -->
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="rings"><span></span><span></span><span></span><span></span></div>

    <!-- Brand above card -->
    <div class="brand">
        <div class="brand-logo">
            <img src="{% static 'img/un-logo.png' %}" alt="United Nations">
            <span class="wordmark">UNPASS</span>
        </div>
        <p class="brand-sub">Unified Platform for Seamless Access, Security &amp; Operations</p>
    </div>

    <!-- Login card -->
    <div class="card">

        <div class="card-head">
            <div class="eyebrow">
                <i class="bi bi-shield-lock-fill"></i>Secure Portal
            </div>
            <h1 class="card-title">Welcome back</h1>
            <p class="card-subtitle">Sign in with your UN credentials to continue.</p>
        </div>

        <div class="card-body">

            {% if messages %}
            <div class="alerts">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }}" role="alert">
                    {% if 'error' in message.tags or 'danger' in message.tags %}<i class="bi bi-exclamation-circle-fill"></i>
                    {% elif 'success' in message.tags %}<i class="bi bi-check-circle-fill"></i>
                    {% elif 'warning' in message.tags %}<i class="bi bi-exclamation-triangle-fill"></i>
                    {% else %}<i class="bi bi-info-circle-fill"></i>{% endif %}
                    <span>{{ message }}</span>
                    <button class="alert-close" aria-label="Dismiss"><i class="bi bi-x-lg" style="font-size:.75rem;"></i></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% if form.non_field_errors %}
            <div class="alerts">
                {% for error in form.non_field_errors %}
                <div class="alert alert-danger" role="alert">
                    <i class="bi bi-exclamation-circle-fill"></i>
                    <span>{{ error }}</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <form method="post" id="loginForm" novalidate>
                {% csrf_token %}

                <!-- Username -->
                <div class="field">
                    <label class="field-label" for="id_username">Username or Email</label>
                    <div class="field-wrap">
                        <i class="bi bi-person field-icon"></i>
                        <input type="text"
                               class="field-input{% if form.login.errors %} is-invalid{% endif %}"
                               id="id_username"
                               name="login"
                               placeholder="Enter your username"
                               autocomplete="username"
                               value="{{ form.login.value|default:'' }}"
                               required>
                    </div>
                    {% if form.login.errors %}
                    <div class="field-error">{% for e in form.login.errors %}{{ e }}{% endfor %}</div>
                    {% endif %}
                </div>

                <!-- Password -->
                <div class="field">
                    <label class="field-label" for="id_password">Password</label>
                    <div class="field-wrap">
                        <i class="bi bi-lock field-icon"></i>
                        <input type="password"
                               class="field-input"
                               id="id_password"
                               name="password"
                               placeholder="Enter your password"
                               autocomplete="current-password"
                               required>
                        <button type="button" class="pw-toggle" id="pwToggle" aria-label="Show password">
                            <i class="bi bi-eye" id="pwIcon"></i>
                        </button>
                    </div>
                </div>

                <!-- Remember + Forgot -->
                <div class="options-row">
                    <label class="remember">
                        <input type="checkbox" name="remember" id="rememberMe">
                        <span>Keep me signed in</span>
                    </label>

                    <div class="forgot-wrap">
                        <a href="#" class="forgot-link" id="forgotBtn" aria-expanded="false">Forgot password?</a>
                        <div class="forgot-popover" id="forgotPopover" role="tooltip">
                            <strong>Password Recovery</strong>
                            Contact your IT department or system administrator to reset your credentials.
                        </div>
                    </div>
                </div>

                <!-- Submit -->
                <button type="submit" class="btn-sign" id="loginBtn">
                    <span class="btn-inner">
                        <i class="bi bi-box-arrow-in-right"></i>Sign In
                    </span>
                    <span class="btn-loader" aria-hidden="true">
                        <span class="spinner-border text-white" role="status"></span>
                    </span>
                </button>

                <div class="sec-note">
                    <i class="bi bi-shield-check"></i>
                    <span>For <strong>authorized UN personnel only</strong>. All access is monitored and logged.</span>
                </div>

            </form>
        </div>

        <div class="card-foot">
            <span class="foot-copy">&copy; {% now "Y" %} United Nations · UNPASS</span>
            <div class="foot-links">
                <a href="#">Privacy</a>
                <a href="#">Terms</a>
                <a href="#">Support</a>
            </div>
        </div>

    </div><!-- /card -->

    <!-- Trust badges below card -->
    <div class="trust-strip">
        <div class="trust-item"><i class="bi bi-shield-lock-fill"></i><span>256-bit TLS</span></div>
        <div class="trust-item"><i class="bi bi-fingerprint"></i><span>2-Factor Auth</span></div>
        <div class="trust-item"><i class="bi bi-eye-slash-fill"></i><span>Zero Data Sharing</span></div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
(function () {
    'use strict';

    /* Auto-focus */
    const uField = document.getElementById('id_username');
    const pField = document.getElementById('id_password');
    if (uField) { uField.value ? pField?.focus() : uField.focus(); }

    /* Password toggle */
    const pwToggle = document.getElementById('pwToggle');
    const pwIcon   = document.getElementById('pwIcon');
    if (pwToggle && pField) {
        pwToggle.addEventListener('click', function () {
            const show = pField.type === 'password';
            pField.type = show ? 'text' : 'password';
            pwIcon.className = show ? 'bi bi-eye-slash' : 'bi bi-eye';
            pwToggle.setAttribute('aria-label', show ? 'Hide password' : 'Show password');
        });
    }

    /* Field validation states on blur */
    document.querySelectorAll('.field-input').forEach(function (input) {
        input.addEventListener('blur', function () {
            if (this.value.trim()) { this.classList.add('is-valid'); this.classList.remove('is-invalid'); }
            else { this.classList.remove('is-valid'); }
        });
        input.addEventListener('input', function () { this.classList.remove('is-valid', 'is-invalid'); });
    });

    /* Form submit — loading state */
    const form = document.getElementById('loginForm');
    const btn  = document.getElementById('loginBtn');
    form.addEventListener('submit', function (e) {
        if (!form.checkValidity()) { e.preventDefault(); return; }
        btn.classList.add('loading');
        btn.disabled = true;
    });

    /* Alert dismiss */
    document.querySelectorAll('.alert-close').forEach(function (x) {
        x.addEventListener('click', function () {
            const el = this.closest('.alert');
            if (!el) return;
            el.style.transition = 'opacity .2s, transform .2s';
            el.style.opacity = '0';
            el.style.transform = 'translateY(-5px)';
            setTimeout(function () { el.remove(); }, 220);
        });
    });

    /* Forgot password popover */
    const forgotBtn     = document.getElementById('forgotBtn');
    const forgotPopover = document.getElementById('forgotPopover');
    if (forgotBtn && forgotPopover) {
        forgotBtn.addEventListener('click', function (e) {
            e.preventDefault();
            const shown = forgotPopover.classList.toggle('show');
            this.setAttribute('aria-expanded', shown ? 'true' : 'false');
        });
        document.addEventListener('click', function (e) {
            if (!forgotBtn.contains(e.target) && !forgotPopover.contains(e.target)) {
                forgotPopover.classList.remove('show');
                forgotBtn.setAttribute('aria-expanded', 'false');
            }
        });
    }

})();
</script>
</body>
</html>