{% extends "base.html" %}
{% block title %}Users Without Radios{% endblock %}

{% block content %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-1">
        <i class="bi bi-people me-2"></i> Users Without Radios
      </h3>
      <p class="text-muted small mb-0">
        Active staff members who do not have any HF or VHF radio assigned
      </p>
    </div>
    <div class="d-flex gap-2">
      {% if users %}
        <div class="btn-group btn-group-sm">
          <a href="{% url 'comms:export_users_without_radios_csv' %}" class="btn btn-outline-secondary">
            <i class="bi bi-filetype-csv me-1"></i> CSV
          </a>
          <a href="{% url 'comms:export_users_without_radios_xlsx' %}" class="btn btn-outline-secondary">
            <i class="bi bi-file-earmark-excel me-1"></i> Excel
          </a>
        </div>
      {% endif %}
      <a href="{% url 'comms:radios' %}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left me-1"></i> Back to Radios
      </a>
    </div>
  </div>

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="card shadow-sm">
    <div class="card-header bg-white">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
          <strong>{{ users|length }}</strong> user{{ users|length|pluralize }} without radio{{ users|length|pluralize }}
        </div>
      </div>
    </div>
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th style="width: 25%;">Username</th>
            <th style="width: 30%;">Full Name</th>
            <th style="width: 20%;">Role</th>
            <th style="width: 25%;">Email</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
            <tr>
              <td>
                <strong>{{ user.username }}</strong>
              </td>
              <td>
                {% if user.get_full_name %}
                  {{ user.get_full_name }}
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td>
                {% if user.role %}
                  <span class="badge bg-info-subtle text-info">
                    {{ user.get_role_display|default:user.role }}
                  </span>
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
              <td>
                {% if user.email %}
                  <a href="mailto:{{ user.email }}" class="text-decoration-none">
                    <i class="bi bi-envelope me-1"></i>{{ user.email }}
                  </a>
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="text-center py-5">
                <div class="text-success">
                  <i class="bi bi-check-circle fs-1 d-block mb-2"></i>
                  <strong>All users have radios assigned!</strong>
                  <p class="text-muted small mb-0">Every active staff member has at least one HF or VHF radio.</p>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  {% if users %}
    <div class="mt-3">
      <div class="alert alert-info mb-0">
        <i class="bi bi-info-circle me-2"></i>
        <strong>Tip:</strong> You can assign radios to users from the 
        <a href="{% url 'comms:radios' %}" class="alert-link">Radios List</a> page.
      </div>
    </div>
  {% endif %}

</div>

<style>
  .badge.bg-info-subtle {
    background-color: rgba(13,202,240,.1)!important;
    color: #0dcaf0!important;
  }
</style>
{% endblock %}