{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Disable SIM/Data Lines</title>
  <style>
    body { margin:0; padding:0; background:#f6f8fb; font-family: Arial, Helvetica, sans-serif; color:#1f2a37; }
    .wrap { width:100%; padding:24px 12px; }
    .card { max-width:720px; margin:0 auto; background:#ffffff; border-radius:14px; overflow:hidden; box-shadow:0 6px 24px rgba(17,24,39,.08); }
    .header { background:linear-gradient(135deg,#009edb,#005a8b); padding:22px 24px; color:#fff; }
    .brand { display:flex; align-items:center; gap:12px; }
    .logo-box { width:44px; height:44px; background:#fff; border-radius:10px; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .logo-box img { max-width:40px; max-height:40px; display:block; }
    .brand-title { line-height:1.15; }
    .brand-title h1 { margin:0; font-size:16px; font-weight:700; letter-spacing:.2px; }
    .brand-title p { margin:4px 0 0; font-size:12px; opacity:.92; }
    .content { padding:22px 24px; }
    .title { margin:0 0 8px; font-size:18px; font-weight:800; }
    .sub { margin:0 0 14px; color:#4b5563; font-size:13px; }

    .alert {
      margin-top:10px;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(220,53,69,.35);
      background:rgba(220,53,69,.06);
    }
    .alert strong { color:#b42318; }
    .grid { margin-top:14px; border:1px solid #eef2f7; border-radius:12px; overflow:hidden; }
    .row { display:flex; gap:0; border-top:1px solid #eef2f7; }
    .row:first-child { border-top:none; }
    .cell { padding:12px 14px; font-size:13px; }
    .cell.k { width:34%; background:#f9fafb; color:#374151; font-weight:700; }
    .cell.v { width:66%; color:#111827; }

    .table { width:100%; border-collapse:collapse; margin-top:10px; font-size:13px; }
    .table th, .table td { border:1px solid #eef2f7; padding:10px; text-align:left; vertical-align:top; }
    .table th { background:#f9fafb; font-weight:800; color:#374151; }

    .badge { display:inline-block; padding:4px 8px; border-radius:8px; background:#eef6ff; color:#1b4d7a; border:1px solid #d6e9ff; font-weight:700; font-size:12px; }
    .muted { color:#6b7280; font-size:12px; }
    .footer { padding:16px 24px; background:#f9fafb; border-top:1px solid #eef2f7; color:#6b7280; font-size:12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">

      <!-- Header -->
      <div class="header">
        <div class="brand">
          <div class="logo-box">
            {% if agency and agency.logo %}
              <img src="{{ agency.logo.url }}" alt="{{ agency.name }} Logo">
            {% else %}
              <img src="{% static 'img/un-logo.png' %}" alt="UN Logo">
            {% endif %}
          </div>

          <div class="brand-title">
            <h1>UN PASS • Disable Lines Request</h1>
            <p>
              {% if agency %}{{ agency.name }}{% else %}Organization{% endif %}
              {% if agency and agency.code %} • {{ agency.code|upper }}{% endif %}
            </p>
          </div>
        </div>
      </div>

      <!-- Content -->
      <div class="content">
        <h2 class="title">Action Required: Disable SIM/Data Lines</h2>
        <p class="sub">
          A staff exit request has been submitted in UN PASS. Please disable/suspend the line(s) below
          <strong>until further notice</strong>.
        </p>

        <div class="alert">
          <strong>Instruction:</strong>
          Suspend the listed MSISDN(s) / data plan(s) for the staff member immediately and confirm internally.
          The service should remain disabled until reissued/approved by the organization.
        </div>

        <div class="grid" role="presentation" aria-hidden="true">
          <div class="row">
            <div class="cell k">Staff Member</div>
            <div class="cell v">
              <strong>{{ user.get_full_name|default:user.username }}</strong>
              {% if user.email %}<div class="muted">{{ user.email }}</div>{% endif %}
            </div>
          </div>

          <div class="row">
            <div class="cell k">Reason</div>
            <div class="cell v">
              <span class="badge">{{ reason|default:"exit"|title }}</span>
              {% if exit_req and exit_req.id %}<span class="muted"> • Ref #{{ exit_req.id }}</span>{% endif %}
            </div>
          </div>

          <div class="row">
            <div class="cell k">Submitted At</div>
            <div class="cell v">
              {% if submitted_at %}{{ submitted_at }}{% elif exit_req %}{{ exit_req.created_at }}{% else %}-{% endif %}
            </div>
          </div>
        </div>

        <h3 style="margin:16px 0 8px; font-size:14px; font-weight:800;">Line(s) to Disable</h3>

        {% if lines and lines|length %}
          <table class="table" role="table" aria-label="Lines to disable">
            <thead>
              <tr>
                <th>MSISDN</th>
                <th>Type</th>
                <th>Provider</th>
                <th>Current Status</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              {% for l in lines %}
                <tr>
                  <td class="mono"><strong>{{ l.msisdn }}</strong></td>
                  <td>
                    {% if l.get_line_type_display %}
                      {{ l.get_line_type_display }}
                    {% else %}
                      {{ l.line_type|default:"-" }}
                    {% endif %}
                  </td>
                  <td>{{ l.provider|default:"-" }}</td>
                  <td>{{ l.status|default:"-" }}</td>
                  <td>{{ l.notes|default:"" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>

          <p class="muted" style="margin-top:10px;">
            Note: The system has marked these line(s) as <strong>suspended</strong> internally. Please ensure
            the provider-level service is disabled until further notice.
          </p>
        {% else %}
          <p class="muted">No lines were found for this request.</p>
        {% endif %}

        <p class="muted" style="margin-top:14px;">
          This is an automated message from UN PASS. Please do not reply to this email.
        </p>
      </div>

      <!-- Footer -->
      <div class="footer">
        UN PASS • United Nations Security Management System
        {% if agency %} • {{ agency.name }}{% endif %}
      </div>

    </div>
  </div>
</body>
</html>
